---
alwaysApply: true
---

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Payload CMS å’Œ Next.js æ„å»ºçš„å¤šè¯­è¨€åšå®¢é¡¹ç›®ï¼Œé‡‡ç”¨ TypeScript è¿›è¡Œç±»å‹å®‰å…¨å¼€å‘ã€‚

---

## ğŸ“ æ¶æ„åŸåˆ™

### 1. å…³æ³¨ç‚¹åˆ†ç¦»

**ä¸¥æ ¼åŒºåˆ† I18n å’Œ Localizationï¼š**

- **I18n (å›½é™…åŒ–)**: ç”¨äºç•Œé¢æ–‡æœ¬ç¿»è¯‘
  - æŒ‰é’®ã€æ ‡ç­¾ã€æç¤ºä¿¡æ¯ã€å¯¼èˆªæ–‡æœ¬ç­‰
  - ä½¿ç”¨ `src/lib/translations.ts` ç¿»è¯‘ç³»ç»Ÿ
  - ç¤ºä¾‹ï¼š`t('blog.title')`, `t('common.loading')`

- **Localization (æœ¬åœ°åŒ–)**: ç”¨äºå†…å®¹æ•°æ®çš„å¤šè¯­è¨€ç‰ˆæœ¬
  - æ–‡ç« æ ‡é¢˜ã€æ­£æ–‡ã€æè¿°ç­‰
  - ä½¿ç”¨ Payload CMS çš„ Localization åŠŸèƒ½
  - ç¤ºä¾‹ï¼š`payload.find({ locale: 'zh' })`

**æ°¸è¿œä¸è¦æ··æ·†è¿™ä¸¤ä¸ªæ¦‚å¿µï¼**

---

## ğŸŒ å›½é™…åŒ– (I18n) è§„èŒƒ

### ç¿»è¯‘ç³»ç»Ÿä½¿ç”¨

**âœ… æ­£ç¡®åšæ³•ï¼š**

```typescript
import { createTranslator, type Locale } from '@/lib/translations'

export default async function Page({ params }: Props) {
  const { locale } = await params
  const t = createTranslator(locale)
  
  return (
    <div>
      <h1>{t('blog.title')}</h1>
      <p>{t('blog.description')}</p>
    </div>
  )
}
```

**âŒ é”™è¯¯åšæ³•ï¼š**

```typescript
// ä¸è¦ä½¿ç”¨ç¡¬ç¼–ç çš„ä¸‰å…ƒè¡¨è¾¾å¼
<h1>{locale === 'zh' ? 'åšå®¢' : 'Blog'}</h1>

// ä¸è¦åœ¨ç»„ä»¶ä¸­ç›´æ¥å†™ç¿»è¯‘æ–‡æœ¬
<h1>åšå®¢</h1>
```

### ç¿»è¯‘é”®å‘½åè§„èŒƒ

**ä½¿ç”¨å‘½åç©ºé—´.åŠŸèƒ½.æè¿°çš„æ ¼å¼ï¼š**

```typescript
// âœ… æ¨è
'blog.title'
'blog.post.readMore'
'auth.login.button'
'error.notFound.message'
'common.loading'
'common.error'

// âŒ é¿å…
'blogTitle'
'readMoreButton'
'error1'
```

### æ·»åŠ æ–°ç¿»è¯‘

**æ­¥éª¤ï¼š**

1. åœ¨ `src/lib/translations.ts` ä¸­æ·»åŠ ï¼š

```typescript
export const translations = {
  zh: {
    // æŒ‰å‘½åç©ºé—´ç»„ç»‡
    blog: { /* ... */ },
    common: { /* ... */ },
    newFeature: {  // æ–°åŠŸèƒ½
      title: 'æ–°åŠŸèƒ½æ ‡é¢˜',
      description: 'æ–°åŠŸèƒ½æè¿°',
    }
  },
  en: {
    blog: { /* ... */ },
    common: { /* ... */ },
    newFeature: {
      title: 'New Feature Title',
      description: 'New Feature Description',
    }
  }
}
```

2. TypeScript ä¼šè‡ªåŠ¨æ›´æ–°ç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤

3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```typescript
{t('newFeature.title')}
```

### æ—¥æœŸå’Œæ—¶é—´æœ¬åœ°åŒ–

**å§‹ç»ˆä½¿ç”¨åŠ¨æ€çš„ localeï¼š**

```typescript
// âœ… æ­£ç¡®
new Date(date).toLocaleDateString(
  locale === 'zh' ? 'zh-CN' : 'en-US',
  { year: 'numeric', month: 'long', day: 'numeric' }
)

// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç 
new Date(date).toLocaleDateString('zh-CN', { /* ... */ })
```

---

## ğŸ—ºï¸ è·¯ç”±è§„èŒƒ

### URL ç»“æ„

**ä½¿ç”¨è·¯å¾„å‰ç¼€ï¼Œä¸ä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼š**

```typescript
// âœ… æ­£ç¡®ï¼šè·¯å¾„å‰ç¼€ï¼ˆSEO å‹å¥½ï¼‰
/zh/blog
/en/blog
/zh/blog/my-post
/en/blog/my-post

// âŒ é”™è¯¯ï¼šæŸ¥è¯¢å‚æ•°
/blog?locale=zh
/blog/my-post?locale=zh
```

### åˆ›å»ºé“¾æ¥

**å§‹ç»ˆåŒ…å«è¯­è¨€å‰ç¼€ï¼š**

```typescript
// âœ… æ­£ç¡®
<Link href={`/${locale}/blog`}>åšå®¢</Link>
<Link href={`/${locale}/blog/${post.slug}`}>æ–‡ç« </Link>

// âŒ é”™è¯¯ï¼šç¼ºå°‘è¯­è¨€å‰ç¼€
<Link href="/blog">åšå®¢</Link>
```

### åŠ¨æ€è·¯ç”±å‚æ•°

**å§‹ç»ˆéªŒè¯ locale å‚æ•°ï¼š**

```typescript
import { isValidLocale, type Locale } from '@/lib/translations'
import { notFound } from 'next/navigation'

type Props = {
  params: Promise<{ locale: string }>
}

export default async function Page(props: Props) {
  const { locale: localeParam } = await props.params
  
  // éªŒè¯ locale
  if (!isValidLocale(localeParam)) {
    notFound()  // è¿”å› 404
  }
  
  const locale = localeParam as Locale
  // ... ç»§ç»­å¤„ç†
}
```

### ç”Ÿæˆé™æ€å‚æ•°

**ä¸ºæ‰€æœ‰è¯­è¨€ç”Ÿæˆé™æ€é¡µé¢ï¼š**

```typescript
export async function generateStaticParams() {
  return [
    { locale: 'zh' },
    { locale: 'en' },
  ]
}
```

---

## ğŸ“¦ Payload CMS Localization

### è·å–æœ¬åœ°åŒ–å†…å®¹

**å§‹ç»ˆä¼ é€’ locale å‚æ•°ï¼š**

```typescript
const posts = await payload.find({
  collection: 'posts',
  locale: locale,  // 'zh' æˆ– 'en'
  where: { /* ... */ },
})
```

### é…ç½®æœ¬åœ°åŒ–å­—æ®µ

**åœ¨ Collection ä¸­æ ‡è®°éœ€è¦æœ¬åœ°åŒ–çš„å­—æ®µï¼š**

```typescript
{
  name: 'title',
  type: 'text',
  localized: true,  // å¯ç”¨æœ¬åœ°åŒ–
}
```

### å…ƒæ•°æ®æœ¬åœ°åŒ–

**ä½¿ç”¨ç¿»è¯‘ç³»ç»Ÿç”ŸæˆåŠ¨æ€å…ƒæ•°æ®ï¼š**

```typescript
export async function generateMetadata({ params }: Props) {
  const { locale } = await params
  const t = createTranslator(locale)
  
  return {
    title: t('blog.title'),
    description: t('blog.description'),
  }
}
```

---

## ğŸ¨ ç»„ä»¶å¼€å‘è§„èŒƒ

### Server Components

```typescript
import { createTranslator, type Locale } from '@/lib/translations'

type Props = {
  params: Promise<{ locale: string }>
}

export default async function ServerComponent(props: Props) {
  const { locale: localeParam } = await props.params
  const locale = localeParam as Locale
  const t = createTranslator(locale)
  
  return <div>{t('key')}</div>
}
```

### Client Components

```typescript
'use client'

import { usePathname } from 'next/navigation'
import { createTranslator, type Locale } from '@/lib/translations'

export default function ClientComponent() {
  const pathname = usePathname()
  const locale = pathname.split('/')[1] as Locale
  const t = createTranslator(locale)
  
  return <div>{t('key')}</div>
}
```

### è¯­è¨€åˆ‡æ¢å™¨

**ä½¿ç”¨è·¯å¾„æ›¿æ¢ï¼Œä¸ä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼š**

```typescript
const handleLocaleChange = (newLocale: string) => {
  const segments = pathname.split('/')
  
  if (segments[1] === 'zh' || segments[1] === 'en') {
    segments[1] = newLocale  // æ›¿æ¢è¯­è¨€ä»£ç 
  }
  
  router.push(segments.join('/'))
}
```

---

## â™¿ æ— éšœç¢æ€§è§„èŒƒ

### è¯­è¨€åˆ‡æ¢å™¨

**å¿…é¡»åŒ…å«çš„ ARIA å±æ€§ï¼š**

```typescript
<button
  aria-label={locale === 'zh' ? 'åˆ‡æ¢è¯­è¨€' : 'Switch language'}
  aria-expanded={isOpen}
  aria-haspopup="true"
>
  {/* å†…å®¹ */}
</button>

<div role="menu">
  <button
    role="menuitem"
    aria-current={locale.code === currentLocale ? 'true' : 'false'}
  >
    {/* é€‰é¡¹ */}
  </button>
</div>
```

### HTML lang å±æ€§

**åœ¨ layout ä¸­è®¾ç½®æ­£ç¡®çš„ lang å±æ€§ï¼š**

```typescript
export default async function LocaleLayout({ params, children }) {
  const { locale } = await params
  
  return (
    <html lang={locale}>
      <body>{children}</body>
    </html>
  )
}
```

---

## ğŸ” SEO æœ€ä½³å®è·µ

### Hreflang æ ‡ç­¾

**åœ¨ layout æˆ– metadata ä¸­æ·»åŠ ï¼š**

```typescript
export async function generateMetadata({ params }) {
  const { locale } = await params
  
  return {
    alternates: {
      canonical: `https://example.com/${locale}`,
      languages: {
        'zh': 'https://example.com/zh',
        'en': 'https://example.com/en',
      },
    },
  }
}
```

### ç«™ç‚¹åœ°å›¾

**ä¸ºæ¯ä¸ªè¯­è¨€ç”Ÿæˆç‹¬ç«‹çš„ sitemapï¼š**

```
/zh/sitemap.xml
/en/sitemap.xml
```

---

## ğŸ§ª ç±»å‹å®‰å…¨

### ç¿»è¯‘é”®ç±»å‹æ£€æŸ¥

**ç³»ç»Ÿä¼šè‡ªåŠ¨æä¾›ç±»å‹æ£€æŸ¥ï¼š**

```typescript
// âœ… æ­£ç¡® - TypeScript çŸ¥é“è¿™ä¸ªé”®å­˜åœ¨
t('blog.title')

// âŒ é”™è¯¯ - TypeScript ä¼šæŠ¥é”™
t('blog.titel')  // æ‹¼å†™é”™è¯¯
t('blg.title')   // å‘½åç©ºé—´é”™è¯¯
```

### Locale ç±»å‹

**å§‹ç»ˆä½¿ç”¨ Locale ç±»å‹ï¼š**

```typescript
import { type Locale } from '@/lib/translations'

const locale: Locale = 'zh'  // âœ… ç±»å‹å®‰å…¨
const locale = 'fr' as Locale  // âŒ è¿è¡Œæ—¶å¯èƒ½å‡ºé”™
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### é™æ€ç”Ÿæˆ

**å°½å¯èƒ½ä½¿ç”¨é™æ€ç”Ÿæˆï¼š**

```typescript
// ç”Ÿæˆæ‰€æœ‰è¯­è¨€ç‰ˆæœ¬çš„é™æ€é¡µé¢
export async function generateStaticParams() {
  return [{ locale: 'zh' }, { locale: 'en' }]
}
```

### å¢é‡é™æ€å†ç”Ÿ

**ä¸ºåŠ¨æ€å†…å®¹è®¾ç½® revalidateï¼š**

```typescript
export const revalidate = 3600  // æ¯å°æ—¶é‡æ–°ç”Ÿæˆ
```

---

## ğŸ“ ä»£ç å®¡æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œæ£€æŸ¥ï¼š

- [ ] æ‰€æœ‰ç•Œé¢æ–‡æœ¬éƒ½ä½¿ç”¨ç¿»è¯‘å‡½æ•° `t()`ï¼Œæ²¡æœ‰ç¡¬ç¼–ç 
- [ ] æ‰€æœ‰é“¾æ¥éƒ½åŒ…å«è¯­è¨€å‰ç¼€ `/${locale}/path`
- [ ] æ—¥æœŸ/æ—¶é—´ä½¿ç”¨æ­£ç¡®çš„ locale æ ¼å¼åŒ–
- [ ] åŠ¨æ€è·¯ç”±éªŒè¯äº† locale å‚æ•°
- [ ] æ·»åŠ äº†é€‚å½“çš„ ARIA å±æ€§
- [ ] æ–°å¢ç¿»è¯‘å·²æ·»åŠ åˆ°æ‰€æœ‰æ”¯æŒçš„è¯­è¨€
- [ ] ç¿»è¯‘é”®éµå¾ªå‘½åè§„èŒƒï¼ˆå‘½åç©ºé—´.åŠŸèƒ½.æè¿°ï¼‰
- [ ] æ²¡æœ‰æ··æ·† I18n å’Œ Localization
- [ ] TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] æµ‹è¯•äº†æ‰€æœ‰æ”¯æŒçš„è¯­è¨€

---

## ğŸ¯ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: ç¡¬ç¼–ç ç¿»è¯‘æ–‡æœ¬

```typescript
// âŒ é”™è¯¯
<h1>{locale === 'zh' ? 'åšå®¢' : 'Blog'}</h1>

// âœ… æ­£ç¡®
<h1>{t('blog.title')}</h1>
```

### é”™è¯¯ 2: ç¼ºå°‘è¯­è¨€å‰ç¼€çš„é“¾æ¥

```typescript
// âŒ é”™è¯¯
<Link href="/blog">åšå®¢</Link>

// âœ… æ­£ç¡®
<Link href={`/${locale}/blog`}>{t('blog.title')}</Link>
```

### é”™è¯¯ 3: æœªéªŒè¯ locale å‚æ•°

```typescript
// âŒ é”™è¯¯
const locale = params.locale as Locale

// âœ… æ­£ç¡®
if (!isValidLocale(params.locale)) {
  notFound()
}
const locale = params.locale as Locale
```

### é”™è¯¯ 4: æ—¥æœŸæ ¼å¼ç¡¬ç¼–ç 

```typescript
// âŒ é”™è¯¯
new Date(date).toLocaleDateString('zh-CN')

// âœ… æ­£ç¡®
new Date(date).toLocaleDateString(
  locale === 'zh' ? 'zh-CN' : 'en-US'
)
```

### é”™è¯¯ 5: ç¿»è¯‘é”®ä¸ä¸€è‡´

```typescript
// âŒ é”™è¯¯ï¼šä¸åŒçš„å‘½åé£æ ¼
t('blogTitle')
t('blog_description')
t('Blog-Author')

// âœ… æ­£ç¡®ï¼šç»Ÿä¸€çš„å‘½åé£æ ¼
t('blog.title')
t('blog.description')
t('blog.author')
```

---

## ğŸŒŸ æ·»åŠ æ–°è¯­è¨€çš„æ­¥éª¤

1. **æ›´æ–°ç¿»è¯‘æ–‡ä»¶** (`src/lib/translations.ts`):

```typescript
export const translations = {
  zh: { /* ... */ },
  en: { /* ... */ },
  ja: {  // æ–°è¯­è¨€
    blog: { title: 'ãƒ–ãƒ­ã‚°', /* ... */ },
    common: { loading: 'èª­ã¿è¾¼ã¿ä¸­...', /* ... */ }
  }
}

export type Locale = 'zh' | 'en' | 'ja'
export const locales: Locale[] = ['zh', 'en', 'ja']
```

2. **æ›´æ–°è¯­è¨€åˆ‡æ¢å™¨** (`src/components/LocaleSwitcher.tsx`):

```typescript
const locales = [
  { code: 'zh', label: 'ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
  { code: 'en', label: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
  { code: 'ja', label: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
]
```

3. **æ›´æ–° Payload é…ç½®** (`src/payload.config.ts`):

```typescript
localization: {
  locales: [
    { label: 'English', code: 'en' },
    { label: 'ä¸­æ–‡', code: 'zh' },
    { label: 'æ—¥æœ¬èª', code: 'ja' },
  ],
}
```

4. **æ›´æ–°ä¸­é—´ä»¶** (å¦‚æœéœ€è¦ç‰¹æ®Šçš„è¯­è¨€æ£€æµ‹è§„åˆ™)

5. **æµ‹è¯•æ–°è¯­è¨€**:
   - è®¿é—® `/ja/blog`
   - æµ‹è¯•è¯­è¨€åˆ‡æ¢
   - éªŒè¯æ‰€æœ‰ç¿»è¯‘éƒ½å·²æ·»åŠ 

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Next.js Internationalization](https://nextjs.org/docs/app/building-your-application/routing/internationalization)
- [Payload Localization](https://payloadcms.com/docs/configuration/localization)
- [Payload I18n](https://payloadcms.com/docs/configuration/i18n)
- [MDN: Accept-Language](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language)
- [W3C ARIA](https://www.w3.org/TR/wai-aria/)

---

## ğŸ’¡ AI åŠ©æ‰‹æŒ‡å—

å½“ç”¨æˆ·è¯·æ±‚æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®æ”¹ä»£ç æ—¶ï¼š

1. **æ£€æŸ¥æ˜¯å¦æ¶‰åŠç”¨æˆ·ç•Œé¢æ–‡æœ¬**
   - å¦‚æœæ˜¯ï¼Œä½¿ç”¨ç¿»è¯‘ç³»ç»Ÿï¼Œä¸è¦ç¡¬ç¼–ç 

2. **æ£€æŸ¥æ˜¯å¦åˆ›å»ºæ–°é“¾æ¥**
   - ç¡®ä¿åŒ…å« `/${locale}` å‰ç¼€

3. **æ£€æŸ¥æ˜¯å¦å¤„ç†æ—¥æœŸ/æ—¶é—´**
   - ä½¿ç”¨åŠ¨æ€ locale æ ¼å¼åŒ–

4. **æ£€æŸ¥æ˜¯å¦åˆ›å»ºæ–°è·¯ç”±**
   - éªŒè¯ locale å‚æ•°
   - ç”Ÿæˆé™æ€å‚æ•°

5. **æ£€æŸ¥æ˜¯å¦æ·»åŠ æ–°ç¿»è¯‘**
   - ä¸ºæ‰€æœ‰æ”¯æŒçš„è¯­è¨€æ·»åŠ ç¿»è¯‘
   - éµå¾ªå‘½åè§„èŒƒ

6. **æé†’ç”¨æˆ·æµ‹è¯•**
   - æµ‹è¯•æ‰€æœ‰æ”¯æŒçš„è¯­è¨€
   - éªŒè¯ç±»å‹å®‰å…¨

---

## âœ¨ æ€»ç»“

æœ¬é¡¹ç›®é‡‡ç”¨ï¼š

- **ç±»å‹å®‰å…¨çš„ç¿»è¯‘ç³»ç»Ÿ**ï¼šç¼–è¯‘æ—¶æ•è·é”™è¯¯
- **è·¯å¾„å‰ç¼€è·¯ç”±**ï¼šSEO å‹å¥½çš„ URL ç»“æ„
- **è‡ªåŠ¨è¯­è¨€æ£€æµ‹**ï¼šåŸºäºæµè§ˆå™¨åå¥½
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šæ¸…æ™°åŒºåˆ† I18n å’Œ Localization
- **å®Œæ•´çš„æ— éšœç¢æ”¯æŒ**ï¼šARIA å±æ€§å’Œè¯­ä¹‰åŒ–æ ‡è®°
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé™æ€ç”Ÿæˆå’Œ ISR

**éµå¾ªè¿™äº›è§„èŒƒï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§ï¼** ğŸš€
